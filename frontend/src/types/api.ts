/**
 * TypeScript API type definitions for OntoSight visualization engine.
 *
 * These types mirror the Pydantic models defined in the Python backend.
 * Generated to match ontosight/models.py and ontosight/server/models/api.py
 *
 * Contract Alignment:
 * - Node<T> ↔ Pydantic Node[T]
 * - Edge<T> ↔ Pydantic Edge[T]
 * - HyperEdge<T> ↔ Pydantic HyperEdge[T]
 *
 * All types support JSON serialization and are used for API request/response
 * validation.
 *
 * Archived Types (Phase 7+ features):
 * - TreeNode<T> - Backend support planned for tree visualization
 * - TreeData - Backend support planned for tree visualization
 * - TableData - Merged into list visualization
 */

/**
 * Generic node for graph visualization.
 * 
 * @template T - Type of domain-specific data
 * 
 * @example
 * const node: Node<PersonData> = {
 *   id: "person_1",
 *   data: { label: "Alice (age 30)", raw: { name: "Alice", age: 30 } }
 * };
 */
export interface Node<T> {
  /** Unique node identifier within the graph */
  id: string;
  /** Domain-specific data with label and raw fields */
  data: {
    /** Display label for UI rendering */
    label: string;
    /** Original object data */
    raw: T;
    /** Additional G6 properties (x, y, style, etc.) */
    [key: string]: any;
  };
}

/**
 * Generic edge connecting two nodes.
 * 
 * @template T - Type of edge metadata
 * 
 * @example
 * const edge: Edge<RelationData> = {
 *   id: "edge_1",
 *   source: "person_1",
 *   target: "person_2",
 *   data: { label: "friend since 2020", raw: { relation: "friend", since: 2020 } }
 * };
 */
export interface Edge<T> {
  /** Unique edge identifier */
  id: string;
  /** Source node identifier */
  source: string;
  /** Target node identifier */
  target: string;
  /** Edge metadata with label and raw fields */
  data: {
    /** Display label for edge */
    label: string;
    /** Original edge data */
    raw: T;
    /** Additional G6 properties */
    [key: string]: any;
  };
}

/**
 * Generic item for list/table visualization.
 * 
 * @template T - Type of item data
 * 
 * @example
 * const item: Item<PersonData> = {
 *   id: "person_1",
 *   data: { label: "Alice", raw: { name: "Alice", age: 30 } }
 * };
 */
export interface Item<T> {
  /** Unique item identifier */
  id: string;
  /** Item data with label and raw fields */
  data: {
    /** Display label */
    label: string;
    /** Original item data */
    raw: T;
    /** Additional properties */
    [key: string]: any;
  };
}

/**
 * Multi-node edge connecting more than 2 nodes.
 * Used for hypergraph visualization.
 * 
 * @template T - Type of hyperedge metadata
 * 
 * @example
 * const hyperedge: Hyperedge<ProjectData> = {
 *   nodes: ["researcher_1", "researcher_2", "researcher_3"],
 *   data: { label: "AI Safety collaboration", raw: { project: "AI Safety" } }
 * };
 */
export interface Hyperedge<T> {
  /** List of node IDs in this hyperedge (minimum 2) */
  nodes: string[];
  /** Hyperedge metadata with label and raw fields */
  data: {
    /** Display label */
    label: string;
    /** Original hyperedge data */
    raw: T;
    /** Additional properties */
    [key: string]: any;
  };
}

// ============================================================================
// Internal API Models
// ============================================================================

/**
 * JSON Schema representation for data types.
 * Generated by Pydantic's model_json_schema() method.
 */
export interface SchemaUnit {
  schema: Record<string, any>;
}

/**
 * Metadata response for /api/meta endpoint.
 * Contains JSON schemas for all visualization data types.
 * 
 * Frontend uses these schemas to dynamically render property panels.
 */
export interface Meta {
  /** JSON Schema for nodes */
  node_schema?: Record<string, any>;
  /** JSON Schema for edges */
  edge_schema?: Record<string, any>;
  /** JSON Schema for individual items (lists/tables) */
  item_schema?: Record<string, any>;
  /** JSON Schema for hyperedges */
  hyperedge_schema?: Record<string, any>;
}

/**
 * Search query request.
 */
export interface SearchRequest {
  /** Search query string */
  query: string;
  /** Optional context data passed to search callback */
  context?: Record<string, any>;
}

/**
 * Search results response.
 */
export interface SearchResponse {
  /** List of matching item IDs */
  results: string[];
}

/**
 * Chat query request.
 */
export interface ChatRequest {
  /** User question or message */
  query: string;
  /** Optional context (conversation history, selected items, etc.) */
  context?: Record<string, any>;
}

/**
 * Chat response.
 */
export interface ChatResponse {
  /** Response text from LLM or callback */
  response: string;
  /** Optional list of source item IDs */
  sources?: string[];
}

/**
 * Complete visualization data payload for /api/data endpoint.
 */
export interface VisualizationData {
    payload: GraphPayload | HypergraphPayload | ListPayload;
}

export interface GraphData {
    nodes: Node<any>[];
    edges: Edge<any>[];
}

export interface HypergraphData {
    nodes: Node<any>[];
    edges: Hyperedge<any>[];
}

export interface ListData {
    items: Item<any>[];
}

export interface GraphPayload {
    type: "graph";
    data: GraphData;
}

export interface HypergraphPayload {
    type: "hypergraph";
    data: HypergraphData;
}

export interface ListPayload {
    type: "list";
    data: ListData;
}
