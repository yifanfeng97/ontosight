import{r as l,u as f,a as g,j as p}from"./index-WuE-ptUs.js";import{s as h,r as m,G as y}from"./preset-BbVrjj7R.js";const w=()=>{const e=l.useRef(null),r=l.useRef(null),{data:n,selectedNodes:s}=f(),{results:i}=g();return l.useEffect(()=>{if(e.current){try{if(!n||!n.nodes||!n.edges){h.warning("缺少超图数据");return}const{hyperEdges:o,transformedData:t}=S(n);r.current?(r.current.data(t),r.current.render()):r.current=E(e.current,t),r.current&&I(r.current,o),i.length>0&&r.current&&v(r.current,i)}catch(o){console.error("Hypergraph 渲染错误:",o),h.error("超图可视化失败")}return()=>{r.current&&(r.current.destroy(),r.current=null)}}},[n,i]),p.jsx("div",{ref:e,className:"hypergraph-view"})};function S(e){const r=[],n=[],s=[],i=new Map;e.edges.forEach((t,c)=>{i.has(t.source)||i.set(t.source,[]),i.get(t.source).push(t.target)}),i.forEach((t,c)=>{if(t.length>=2){const d=`hyperedge-${c}-${t.join("-")}`,a={id:d,label:`HyperEdge (${t.length} nodes)`,nodes:t,color:"#722ed1"};r.push(a),n.push({id:d,label:a.label,type:"hyperEdge"}),t.forEach(u=>{s.push({source:d,target:u,label:""})})}});const o={nodes:[...e.nodes,...n],edges:[...e.edges,...s]};return{hyperEdges:r,transformedData:o}}function E(e,r){(void 0)("hyperEdge")||m("node","hyperEdge",{draw(o,t){const d=o.color||"#722ed1";return t.addShape("circle",{attrs:{x:0,y:0,r:10,fill:"#fff",stroke:d,lineWidth:2,dashArray:[5,5]}}),t.addShape("circle",{attrs:{x:0,y:0,r:3,fill:d}}),t},setState(o,t,c){const a=c.getContainer().getChildren()[0];o==="highlighted"?t?(a.attr("r",15),a.attr("lineWidth",3)):(a.attr("r",10),a.attr("lineWidth",2)):o==="selected"&&(t?(a.attr("fill","#722ed1"),a.attr("fillOpacity",.3)):(a.attr("fill","#fff"),a.attr("fillOpacity",1)))}});const n=e.clientWidth||800,s=e.clientHeight||600,i=new y({container:e,width:n,height:s,renderer:"canvas",autoPaint:!0,modes:{default:["drag-canvas","zoom-canvas","drag-node",{type:"click-select",formatIds:o=>o,onSelect:o=>{}}]},layout:{type:"force",preventOverlap:!0,nodeSpacing:50,damping:.999,maxIteration:1e3,gravitationalConstant:-35}});return i.data(r),i.render(),i}function I(e,r){e.on("node:click",n=>{const s=n.item,i=s.getID();s.hasState("selected")?e.setItemState(s,"selected",!1):e.setItemState(s,"selected",!0);const o=r.find(t=>t.id===i);o&&o.nodes.forEach(t=>{const c=e.findById(t);c&&e.setItemState(c,"highlighted",!0)})}),e.on("node:mouseenter",n=>{const s=n.item;e.setItemState(s,"highlighted",!0)}),e.on("node:mouseleave",n=>{const s=n.item;s.hasState("selected")||e.setItemState(s,"highlighted",!1)}),e.on("node:dblclick",n=>{const s=n.item;e.getNeighbors(s).forEach(o=>{e.setItemState(o,"highlighted",!0)})})}function v(e,r){const n=new Set(r);e.getNodes().forEach(s=>{const i=s.getID();n.has(i)?e.setItemState(s,"highlighted",!0):e.setItemState(s,"highlighted",!1)}),r.length>0&&e.focusItem(r[0],!0,{duration:500,easing:"easeCubic"})}export{w as default};
//# sourceMappingURL=HypergraphView-BgVE5cIU.js.map
