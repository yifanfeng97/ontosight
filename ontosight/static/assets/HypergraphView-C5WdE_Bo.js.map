{"version":3,"file":"HypergraphView-C5WdE_Bo.js","sources":["../../../frontend/src/components/views/HypergraphView.tsx"],"sourcesContent":["import React, { useEffect, useRef, memo } from 'react';\nimport * as G6 from '@antv/g6';\nimport { useSearch } from '../../hooks/useSearch';\nimport { message } from 'antd';\nimport './HypergraphView.css';\n\ninterface HypergraphViewProps {\n  data: {\n    nodes: any[];\n    edges: any[];\n  };\n  meta: any;\n}\n\ninterface HyperEdgeInfo {\n  id: string;\n  nodes: string[];\n}\n\nconst HypergraphView = memo(function HypergraphView({ data, meta }: HypergraphViewProps) {\n  const canvasRef = useRef<HTMLDivElement>(null);\n  const graphRef = useRef<any>(null);\n  const { results: searchResults } = useSearch();\n\n  useEffect(() => {\n    if (!canvasRef.current) return;\n\n    try {\n      if (!data || !data.nodes || !data.edges) {\n        return;\n      }\n\n      // Prepare data: convert hyperedges to virtual nodes + edges\n      const { hyperEdges, transformedData } = transformDataToHypergraph(data);\n\n      // Init or update Graph\n      if (!graphRef.current) {\n        graphRef.current = createGraph(canvasRef.current, transformedData);\n      } else {\n        graphRef.current.changeData(transformedData);\n      }\n\n      // Bind events\n      if (graphRef.current) {\n        bindInteractions(graphRef.current, hyperEdges);\n      }\n\n      // Highlight search\n      if (searchResults.length > 0 && graphRef.current) {\n        highlightSearchResults(graphRef.current, searchResults);\n      }\n    } catch (error) {\n      console.error('Hypergraph render error:', error);\n      message.error('Failed to render hypergraph');\n    }\n\n    return () => {\n      if (graphRef.current) {\n        graphRef.current.destroy();\n        graphRef.current = null;\n      }\n    };\n  }, [data, searchResults]);\n\n  return <div ref={canvasRef} className=\"hypergraph-view\" style={{ width: '100%', height: '100%' }} />;\n});\n\n/**\n * Convert hypergraph data format to G6 bipartite format.\n * Hyperedges in 'data.edges' become virtual nodes.\n */\nfunction transformDataToHypergraph(data: { nodes: any[]; edges: any[] }) {\n  const hyperEdges: HyperEdgeInfo[] = [];\n  \n  // Clone nodes to avoid mutating props\n  const g6Nodes = data.nodes.map(n => ({\n    ...n,\n    // Add default style if not present\n    size: 30,\n    style: { fill: '#ECF5FF', stroke: '#409EFF' }\n  }));\n  \n  const g6Edges: any[] = [];\n\n  // data.edges contains hyperedges: { nodes: [id1, id2...], label... }\n  data.edges.forEach((hedge, index) => {\n    const virtualNodeId = `__he_${index}`;\n    const participants = hedge.nodes || [];\n    \n    // 1. Create virtual node for the hyperedge\n    g6Nodes.push({\n      id: virtualNodeId,\n      label: hedge.data?.label || '',\n      type: 'hyper-edge-node', // Custom shape type\n      size: 15,\n      // Metadata to identify it\n      isHyperEdge: true\n    });\n\n    // 2. Map for interaction\n    hyperEdges.push({\n      id: virtualNodeId,\n      nodes: participants\n    });\n\n    // 3. Create edges from virtual node to participants\n    participants.forEach((nodeId: string) => {\n      g6Edges.push({\n        source: virtualNodeId,\n        target: nodeId,\n        type: 'line',\n        style: { stroke: '#B4E5FF' }\n      });\n    });\n  });\n\n  return {\n    hyperEdges,\n    transformedData: { nodes: g6Nodes, edges: g6Edges }\n  };\n}\n\n/**\n * Configure and create G6 Graph instance\n */\nfunction createGraph(container: HTMLDivElement, data: any) {\n  const width = container.clientWidth || 800;\n  const height = container.clientHeight || 600;\n\n  const graph = new G6.Graph({\n    container,\n    width,\n    height,\n    behaviors: ['drag-canvas', 'zoom-canvas', 'drag-node'],\n    layout: {\n      type: 'force',\n      preventOverlap: true,\n      linkDistance: 100,\n      nodeStrength: -30,\n      edgeStrength: 0.1\n    },\n    node: {\n      type: 'circle',\n    },\n    edge: {\n      type: 'line',\n    }\n  });\n\n  graph.setData(data);\n  graph.render();\n  \n  return graph;\n}\n\nfunction bindInteractions(graph: any, hyperEdges: HyperEdgeInfo[]) {\n   graph.on('node:click', (evt: any) => {\n      const node = evt.item;\n      const model = node.getModel();\n      \n      // If clicked a hyperedge virtual node, highlight connected nodes\n      if (model.isHyperEdge) {\n         const info = hyperEdges.find(h => h.id === model.id);\n         if (info) {\n             info.nodes.forEach(nid => {\n                const n = graph.findById(nid);\n                if (n) {\n                   graph.setItemState(n, 'active', true);\n                }\n             });\n         }\n      }\n   });\n   \n   graph.on('canvas:click', () => {\n      graph.getNodes().forEach((n: any) => {\n         graph.clearItemStates(n, 'active');\n      });\n   });\n}\n\nfunction highlightSearchResults(graph: any, results: string[]) {\n   // Implementation similar to GraphView\n   results.forEach(id => {\n      const item = graph.findById(id);\n      if (item) {\n         graph.setItemState(item, 'selected', true);\n      }\n   });\n}\n\nexport default HypergraphView;\n"],"names":["HypergraphView","memo","data","meta","canvasRef","useRef","graphRef","searchResults","useSearch","useEffect","hyperEdges","transformedData","transformDataToHypergraph","createGraph","bindInteractions","highlightSearchResults","error","message","jsx","g6Nodes","n","g6Edges","hedge","index","virtualNodeId","participants","_a","nodeId","container","width","height","graph","G6.Graph","evt","model","info","h","nid","results","id","item"],"mappings":"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"}