{"version":3,"file":"HypergraphView-DPcMJVR5.js","sources":["../../../frontend/src/components/views/HypergraphView.tsx"],"sourcesContent":["import { useEffect, useRef, useCallback, memo } from \"react\";\nimport { useVisualization } from \"@/hooks/useVisualization\";\nimport { useSearch } from \"@/hooks/useSearch\";\nimport { useToast } from \"@/components/ui/toast\";\n\n// 使用全局 G6（通过 index.html 中的 script 标签引入 g6.min.js）\ndeclare global {\n  interface Window {\n    G6: any;\n  }\n}\n\ninterface HypergraphViewProps {\n  data: {\n    nodes: any[];\n    edges: any[];\n    hyperedges: Array<{\n      id: string;\n      label: string;\n      node_set: string[];\n      data: any;\n    }>;\n  };\n  meta: any;\n}\n\n// 颜色调色板，为每个超边生成不同颜色\nconst HYPEREDGE_COLORS = [\n  { fill: \"#1890FF\", stroke: \"#0050B3\" },\n  { fill: \"#52C41A\", stroke: \"#274704\" },\n  { fill: \"#FA8C16\", stroke: \"#872000\" },\n  { fill: \"#EB2F96\", stroke: \"#780C56\" },\n  { fill: \"#13C2C2\", stroke: \"#0C464C\" },\n  { fill: \"#722ED1\", stroke: \"#38165F\" },\n  { fill: \"#F5222D\", stroke: \"#7F0000\" },\n  { fill: \"#FA541C\", stroke: \"#7F2C00\" },\n  { fill: \"#FFC53D\", stroke: \"#7F6400\" },\n  { fill: \"#45B39D\", stroke: \"#0F5C4C\" },\n];\n\nfunction getHyperedgeColor(index: number) {\n  return HYPEREDGE_COLORS[index % HYPEREDGE_COLORS.length];\n}\n\n// 选中状态的超边颜色\nconst SELECTED_HYPEREDGE_COLOR = { fill: \"#1890ff\", stroke: \"#0050b3\" };\n\nconst HypergraphView = memo(function HypergraphView({ data, meta }: HypergraphViewProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const graphRef = useRef<any>(null);\n  const hyperedgesRef = useRef<Map<string, any>>(new Map()); // Store hyperedges for click detection\n  const hyperedgeColorsRef = useRef<Map<string, { fill: string; stroke: string }>>(new Map()); // Store original colors\n  const selectedItemsRef = useRef(new Map());\n  const { selectedItems, selectItem, deselectItem, clearSelection, resetTrigger } = useVisualization();\n  const { results: searchResults } = useSearch();\n  const { addToast } = useToast();\n\n  // Keep ref in sync with state\n  useEffect(() => {\n    selectedItemsRef.current = selectedItems;\n  }, [selectedItems]);\n\n  const handleNodeClick = useCallback(\n    (evt: any) => {\n      const nodeId = evt.target?.id;\n      if (!nodeId) return;\n\n      if (selectedItemsRef.current.has(nodeId)) {\n        deselectItem(nodeId);\n      } else {\n        selectItem(nodeId, \"node\");\n      }\n    },\n    [selectItem, deselectItem]\n  );\n\n  const handleHyperedgeClick = useCallback(\n    (hyperedgeId: string) => {\n      if (selectedItemsRef.current.has(hyperedgeId)) {\n        deselectItem(hyperedgeId);\n      } else {\n        selectItem(hyperedgeId, \"hyperedge\");\n      }\n    },\n    [selectItem, deselectItem]\n  );\n\n  const handleKeyDown = useCallback((evt: KeyboardEvent) => {\n    if (evt.key === 'Escape') {\n      clearSelection();\n    } else if ((evt.ctrlKey || evt.metaKey) && evt.key === 'f') {\n      evt.preventDefault();\n      addToast('搜索面板已激活', 'info');\n    } else if (evt.key === 'Delete' && selectedItemsRef.current.size > 0) {\n      selectedItemsRef.current.forEach((item) => {\n        deselectItem(item.id);\n      });\n      addToast('已清除选中项', 'success');\n    }\n  }, [clearSelection, deselectItem, addToast]);\n\n  const highlightSearchResults = useCallback((graph: any) => {\n    if (!graph) return;\n\n    try {\n      const allNodeData = graph.getNodeData() || [];\n      const searchResultSet = new Set(searchResults);\n\n      allNodeData.forEach((nodeData: any) => {\n        const nodeId = nodeData.id;\n        if (searchResultSet.has(nodeId)) {\n          graph.setElementState(nodeId, ['highlight']);\n        } else {\n          const currentStates = graph.getElementState(nodeId) || [];\n          const newStates = currentStates.filter((state: string) => state !== 'highlight');\n          graph.setElementState(nodeId, newStates);\n        }\n      });\n\n      if (searchResults.length > 0) {\n        graph.focusElement(searchResults[0]);\n      }\n    } catch (error) {\n      console.warn(\"[HypergraphView] Error in highlightSearchResults:\", error);\n    }\n  }, [searchResults]);\n\n  useEffect(() => {\n    // 检查 G6 是否已加载（通过 index.html 中的 script 标签引入）\n    if (!containerRef.current || !data?.nodes || !window.G6) {\n      return;\n    }\n\n    // Clean up old graph\n    if (graphRef.current) {\n      try {\n        graphRef.current.destroy();\n      } catch (e) {\n        console.warn(\"[HypergraphView] Error destroying previous graph:\", e);\n      }\n      graphRef.current = null;\n    }\n\n    try {\n      // Clear old hyperedge data before rebuilding\n      hyperedgesRef.current.clear();\n      hyperedgeColorsRef.current.clear();\n\n      // Build bubble-sets plugins from hyperedges\n      const bubbleSetPlugins = (data.hyperedges || []).map((hyperedge, index) => {\n        const colors = getHyperedgeColor(index);\n        // Store hyperedge metadata and original colors for click detection and style updates\n        hyperedgesRef.current.set(hyperedge.id, hyperedge);\n        hyperedgeColorsRef.current.set(hyperedge.id, colors);\n\n        // Check if this hyperedge is already selected\n        const isSelected = selectedItems.has(hyperedge.id);\n        const activeColors = isSelected ? SELECTED_HYPEREDGE_COLOR : colors;\n\n        return {\n          key: `bubble-sets-${hyperedge.id}`,\n          type: 'bubble-sets',\n          members: hyperedge.node_set,\n          fill: activeColors.fill,\n          fillOpacity: isSelected ? 0.3 : 0.1,\n          stroke: activeColors.stroke,\n          strokeOpacity: isSelected ? 1 : 0.6,\n          label: false,\n          // Store hyperedge data for click event detection (reference: HypergraphViewer)\n          hyperedge: hyperedge,\n        };\n      });\n\n      // Create new graph with G6 (使用全局 window.G6，参考 HypergraphViewer)\n      const graph = new window.G6.Graph({\n        container: containerRef.current,\n        width: containerRef.current.clientWidth,\n        height: containerRef.current.clientHeight,\n        layout: {\n          type: 'force',\n          collide: {\n            radius: (d: any) => d.size / 2,\n          },\n          preventOverlap: true,\n        },\n        behaviors: ['drag-canvas', 'zoom-canvas', 'drag-element'],\n        node: {\n          style: {\n            labelText: (d: any) => d.data?.label || d.id,\n            fontSize: 12,\n          },\n          state: {\n            highlight: {\n              fill: '#ffd666',\n              stroke: '#faad14',\n              lineWidth: 2,\n              shadowColor: '#faad14',\n              shadowBlur: 10,\n            },\n            selected: {\n              fill: '#1890ff',\n              stroke: '#1890ff',\n              lineWidth: 3,\n              shadowColor: '#1890ff',\n              shadowBlur: 10,\n            },\n          },\n        },\n        edge: {\n          style: {\n            labelText: (d: any) => d.data?.label || '',\n            fontSize: 10,\n            stroke: '#B4E5FF',\n            opacity: 0.6,\n          },\n          state: {\n            highlight: {\n              stroke: '#faad14',\n              lineWidth: 2,\n              opacity: 1,\n            },\n          },\n        },\n        data: {\n          nodes: data.nodes.map((node: any) => {\n            const isSelected = selectedItems.has(node.id);\n            return {\n              ...node,\n              style: {\n                ...node.style,\n                fill: isSelected ? \"#1890ff\" : \"#87d068\",\n                lineWidth: isSelected ? 3 : 1,\n                stroke: isSelected ? \"#1890ff\" : \"#666\",\n              },\n            };\n          }),\n          edges: (data.edges || []).map((edge: any) => ({\n            ...edge,\n            style: {\n              stroke: 'transparent',\n              lineWidth: 0,\n              opacity: 0,\n              ...edge.style,\n            },\n          })),\n        },\n        plugins: bubbleSetPlugins,\n        autoFit: 'center',\n      });\n\n      // Register event handlers for nodes\n      graph.on(\"node:click\", handleNodeClick);\n\n      // Helper function to handle bubble-sets click\n      const handleBubbleSetsEvent = (evt: any) => {\n        if (evt.targetType === \"bubble-sets\") {\n          const target = evt.target?.options || evt.target;\n          console.log(\"[HypergraphView] Bubble-sets event:\", target);\n          if (target) {\n            // Try to get hyperedge id directly from stored hyperedge data\n            if (target.hyperedge?.id) {\n              handleHyperedgeClick(target.hyperedge.id);\n              return true;\n            }\n            // Fallback: find hyperedge by key\n            const key = target.key?.replace('bubble-sets-', '');\n            if (key && hyperedgesRef.current.has(key)) {\n              handleHyperedgeClick(key);\n              return true;\n            }\n            // Fallback: find by members\n            for (const [hyperedgeId, hyperedgeData] of hyperedgesRef.current.entries()) {\n              const targetMembers = target.members || [];\n              if (hyperedgeData.node_set &&\n                  targetMembers.length === hyperedgeData.node_set.length &&\n                  targetMembers.every((m: string) => hyperedgeData.node_set.includes(m))) {\n                handleHyperedgeClick(hyperedgeId);\n                return true;\n              }\n            }\n          }\n        }\n        return false;\n      };\n\n      // Register global click handler to detect bubble-sets clicks\n      // Reference: HypergraphViewer uses graph.on(\"pointermove\", ...) with targetType === \"bubble-sets\"\n      graph.on(\"click\", (evt: any) => {\n        console.log(\"[HypergraphView] Click event:\", evt.targetType, evt.target);\n\n        // Check if clicked on a bubble-sets (hyperedge)\n        if (handleBubbleSetsEvent(evt)) {\n          return;\n        }\n\n        // Check if clicked on node (already handled by NodeEvent.CLICK, but just in case)\n        if (evt.targetType === \"node\") {\n          return; // Let NodeEvent.CLICK handle it\n        }\n\n        // Check if clicked on canvas (empty area)\n        if (evt.targetType === \"canvas\") {\n          clearSelection();\n          return;\n        }\n      });\n\n      // Also listen to pointerdown for bubble-sets (some versions of G6 may use this)\n      graph.on(\"pointerdown\", (evt: any) => {\n        if (evt.targetType === \"bubble-sets\") {\n          console.log(\"[HypergraphView] Pointerdown on bubble-sets:\", evt.target);\n          handleBubbleSetsEvent(evt);\n        }\n      });\n\n      // Listen to pointermove to detect hovering over bubble-sets (like HypergraphViewer)\n      graph.on(\"pointermove\", (evt: any) => {\n        if (evt.targetType === \"bubble-sets\") {\n          // Set cursor to pointer when hovering over hyperedge\n          if (containerRef.current) {\n            containerRef.current.style.cursor = \"pointer\";\n          }\n        } else if (evt.targetType === \"canvas\") {\n          if (containerRef.current) {\n            containerRef.current.style.cursor = \"default\";\n          }\n        }\n      });\n\n      // Double-click to highlight neighbors\n      graph.on(\"node:dblclick\", (evt: any) => {\n        try {\n          const nodeId = evt.target?.id;\n          if (!nodeId) return;\n          const neighbors = graph.getNeighborNodesData(nodeId) || [];\n          neighbors.forEach((neighbor: any) => {\n            graph.setElementState(neighbor.id, ['highlight']);\n          });\n        } catch (error) {\n          console.warn(\"[HypergraphView] Error in dblclick handler:\", error);\n        }\n      });\n\n      // Render and apply search highlighting\n      graph.render().then(() => {\n        console.log(\"[HypergraphView] Graph rendered successfully\");\n        highlightSearchResults(graph);\n      }).catch((error: any) => {\n        console.error(\"[HypergraphView] Error rendering graph:\", error);\n      });\n\n      // Handle resize\n      const handleResize = () => {\n        if (containerRef.current && graphRef.current) {\n          try {\n            graphRef.current.resize(\n              containerRef.current.clientWidth,\n              containerRef.current.clientHeight\n            );\n          } catch (error) {\n            console.warn(\"[HypergraphView] Error resizing graph:\", error);\n          }\n        }\n      };\n\n      window.addEventListener(\"resize\", handleResize);\n      window.addEventListener(\"keydown\", handleKeyDown);\n      graphRef.current = graph;\n          \n      // Cleanup function\n      return () => {\n        window.removeEventListener(\"resize\", handleResize);\n        window.removeEventListener(\"keydown\", handleKeyDown);\n\n        if (graphRef.current) {\n          try {\n            graphRef.current.destroy();\n            graphRef.current = null;\n          } catch (e) {\n            console.warn(\"[HypergraphView] Error in cleanup:\", e);\n          }\n        }\n      };\n    } catch (error) {\n      console.error(\"[HypergraphView] Error creating graph:\", error);\n      return () => { };\n    }\n  }, [data, handleNodeClick, handleHyperedgeClick, handleKeyDown, highlightSearchResults]);\n\n  // Re-render graph when reset is triggered (full refresh with cold-start layout)\n  useEffect(() => {\n    if (!graphRef.current || resetTrigger === 0) return;\n\n    const fullRerender = async () => {\n      try {\n        console.log(\"[HypergraphView] Full re-render with cold-start layout...\");\n        \n        // Stop any ongoing layout\n        graphRef.current?.stopLayout();\n        \n        // Clear node coordinates for cold-start layout (not based on current positions)\n        const cleanNodes = data.nodes.map(({ x, y, ...rest }: any) => rest);\n        \n        // Re-set data with cleaned coordinates\n        graphRef.current?.setData({\n          nodes: cleanNodes,\n          edges: data.edges || [],\n        });\n        \n        // Full render: triggers data reconciliation -> layout calculation -> drawing\n        // This will also recalculate BubbleSet hyperedge paths\n        await graphRef.current?.render();\n        \n        // Re-apply search highlighting after render completes\n        if (graphRef.current) {\n          highlightSearchResults(graphRef.current);\n        }\n        \n        console.log(\"[HypergraphView] Full re-render completed\");\n      } catch (error) {\n        console.warn(\"[HypergraphView] Error during full re-render:\", error);\n      }\n    };\n\n    fullRerender();\n  }, [resetTrigger, data, highlightSearchResults]);\n\n  // Update hyperedge and node styles when selection changes (without redrawing)\n  useEffect(() => {\n    if (!graphRef.current || !data) return;\n\n    const updateStyles = async () => {\n      try {\n        // Update node styles based on selection\n        data.nodes?.forEach((node: any) => {\n          const isSelected = selectedItems.has(node.id);\n          graphRef.current?.updateNodeData([{\n            id: node.id,\n            style: {\n              fill: isSelected ? \"#1890ff\" : \"#87d068\",\n              lineWidth: isSelected ? 3 : 1,\n              stroke: isSelected ? \"#1890ff\" : \"#666\",\n            },\n          }]);\n        });\n\n        // Update hyperedge (bubble-sets) styles based on selection\n        data.hyperedges?.forEach((hyperedge: any) => {\n          const isSelected = selectedItems.has(hyperedge.id);\n          const originalColors = hyperedgeColorsRef.current.get(hyperedge.id);\n          if (!originalColors) return;\n\n          const activeColors = isSelected ? SELECTED_HYPEREDGE_COLOR : originalColors;\n          const pluginKey = `bubble-sets-${hyperedge.id}`;\n\n          try {\n            graphRef.current?.updatePlugin({\n              key: pluginKey,\n              fill: activeColors.fill,\n              fillOpacity: isSelected ? 0.3 : 0.1,\n              stroke: activeColors.stroke,\n              strokeOpacity: isSelected ? 1 : 0.6,\n              labelBackgroundFill: activeColors.stroke,\n            });\n          } catch (e) {\n            console.warn(\"[HypergraphView] Error updating plugin:\", pluginKey, e);\n          }\n        });\n\n        // Draw immediately to show style changes\n        await graphRef.current?.draw();\n      } catch (error) {\n        console.warn(\"[HypergraphView] Error updating selection styles:\", error);\n      }\n    };\n\n    updateStyles();\n  }, [selectedItems, data]);\n\n  return (\n    <div className=\"w-full h-full flex flex-col overflow-hidden\">\n      <div ref={containerRef} className=\"hypergraph-view flex-1\" />\n    </div>\n  );\n});\n\nexport default HypergraphView;\n"],"names":["HYPEREDGE_COLORS","getHyperedgeColor","index","SELECTED_HYPEREDGE_COLOR","HypergraphView","memo","data","meta","containerRef","useRef","graphRef","hyperedgesRef","hyperedgeColorsRef","selectedItemsRef","selectedItems","selectItem","deselectItem","clearSelection","resetTrigger","useVisualization","searchResults","useSearch","addToast","useToast","useEffect","handleNodeClick","useCallback","evt","nodeId","_a","handleHyperedgeClick","hyperedgeId","handleKeyDown","item","highlightSearchResults","graph","allNodeData","searchResultSet","nodeData","newStates","state","error","e","bubbleSetPlugins","hyperedge","colors","isSelected","activeColors","d","node","edge","handleBubbleSetsEvent","target","_b","key","_c","hyperedgeData","targetMembers","m","neighbor","handleResize","cleanNodes","x","y","rest","originalColors","pluginKey","jsx"],"mappings":"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"}