import{r as o,u as T,a as z,b as B,j as v}from"./index-Cgw79int.js";import{G as P,N as g,C as D}from"./preset-BE72H_a1.js";const V=[{fill:"#1890FF",stroke:"#0050B3"},{fill:"#52C41A",stroke:"#274704"},{fill:"#FA8C16",stroke:"#872000"},{fill:"#EB2F96",stroke:"#780C56"},{fill:"#13C2C2",stroke:"#0C464C"},{fill:"#722ED1",stroke:"#38165F"},{fill:"#F5222D",stroke:"#7F0000"},{fill:"#FA541C",stroke:"#7F2C00"},{fill:"#FFC53D",stroke:"#7F6400"},{fill:"#45B39D",stroke:"#0F5C4C"}];function O(m){return V[m%V.length]}const _=o.memo(function({data:f,meta:K}){const u=o.useRef(null),l=o.useRef(null),h=o.useRef(null),{selectedNodes:d,selectNode:N,deselectNode:E,clearSelection:k}=T(),{results:C}=z(),{addToast:w}=B(),R=o.useCallback(r=>{var a;const t=(a=r.target)==null?void 0:a.id;t&&(d.has(t)?E(t):N(t))},[d,N,E]),F=o.useCallback(()=>{k()},[k]),H=o.useCallback(r=>{var a,p,i,y;const t=(a=r.target)==null?void 0:a.id;if(!(!t||!h.current||!l.current))try{const n=l.current.getNodeData(t);if(!n)return;const e=l.current.getElementPosition(t),[s,c]=e||[0,0],L=`
        <div class="graph-node-tooltip">
          <div class="tooltip-title">${((p=n.data)==null?void 0:p.label)||n.id}</div>
          <div class="tooltip-id">ID: ${n.id}</div>
          ${(i=n.data)!=null&&i.description?`<div class="tooltip-desc">${n.data.description}</div>`:""}
          ${((y=n.data)==null?void 0:y.value)!==void 0?`<div class="tooltip-value">Value: ${n.data.value}</div>`:""}
        </div>
      `;h.current.innerHTML=L,h.current.style.display="block",h.current.style.left=s+10+"px",h.current.style.top=c+10+"px"}catch(n){console.warn("[HypergraphView] Error in handleNodeMouseEnter:",n)}},[]),S=o.useCallback(()=>{h.current&&(h.current.style.display="none")},[]),b=o.useCallback(r=>{r.key==="Escape"?k():(r.ctrlKey||r.metaKey)&&r.key==="f"?(r.preventDefault(),w("搜索面板已激活","info")):r.key==="Delete"&&d.size>0&&(d.forEach(t=>{E(t)}),w("已清除选中节点","success"))},[d,k,E,w]),x=o.useCallback(r=>{if(r)try{const t=r.getNodeData()||[],a=new Set(C);t.forEach(p=>{const i=p.id;if(a.has(i))r.setElementState(i,["highlight"]);else{const n=(r.getElementState(i)||[]).filter(e=>e!=="highlight");r.setElementState(i,n)}}),C.length>0&&r.focusElement(C[0])}catch(t){console.warn("[HypergraphView] Error in highlightSearchResults:",t)}},[C]);return o.useEffect(()=>{if(!(!u.current||!(f!=null&&f.nodes))){if(l.current){try{l.current.destroy()}catch(r){console.warn("[HypergraphView] Error destroying previous graph:",r)}l.current=null}try{const r=(f.hyperedges||[]).map((e,s)=>{const c=O(s);return{key:`bubble-sets-${e.id}`,type:"bubble-sets",members:e.node_set,labelText:e.label,fill:c.fill,fillOpacity:.1,stroke:c.stroke,strokeOpacity:1,label:!0,labelCloseToPath:!1,labelPlacement:"top",labelBackgroundFill:c.stroke,labelFill:"#fff",labelPadding:3,labelBackgroundRadius:4}}),t=new P({container:u.current,width:u.current.clientWidth,height:u.current.clientHeight,layout:{type:"force",collide:{radius:e=>e.size/2},preventOverlap:!0},behaviors:["drag-canvas","zoom-canvas","drag-element"],node:{style:{labelText:e=>{var s;return((s=e.data)==null?void 0:s.label)||e.id},fontSize:12},state:{highlight:{fill:"#ffd666",stroke:"#faad14",lineWidth:2,shadowColor:"#faad14",shadowBlur:10},selected:{fill:"#1890ff",stroke:"#1890ff",lineWidth:3,shadowColor:"#1890ff",shadowBlur:10}}},edge:{style:{labelText:e=>{var s;return((s=e.data)==null?void 0:s.label)||""},fontSize:10,stroke:"#B4E5FF",opacity:.6},state:{highlight:{stroke:"#faad14",lineWidth:2,opacity:1}}},data:{nodes:f.nodes.map(e=>({...e,style:{...e.style,fill:d.has(e.id)?"#1890ff":"#87d068",lineWidth:d.has(e.id)?3:1,stroke:d.has(e.id)?"#1890ff":"#666"}})),edges:(f.edges||[]).map(e=>({...e,style:{stroke:"#B4E5FF",lineWidth:1,opacity:.6,...e.style}}))},plugins:r,autoFit:"center"}),a=R,p=F,i=H,y=S;t.on(g.CLICK,a),t.on(D.CLICK,p),t.on(g.POINTER_ENTER,i),t.on(g.POINTER_LEAVE,y),t.on(g.DBLCLICK,e=>{var s;try{const c=(s=e.target)==null?void 0:s.id;if(!c)return;(t.getNeighborNodesData(c)||[]).forEach(I=>{t.setElementState(I.id,["highlight"])})}catch(c){console.warn("[HypergraphView] Error in dblclick handler:",c)}}),t.render().then(()=>{console.log("[HypergraphView] Graph rendered successfully"),x(t)}).catch(e=>{console.error("[HypergraphView] Error rendering graph:",e)});const n=()=>{if(u.current&&l.current)try{l.current.resize(u.current.clientWidth,u.current.clientHeight)}catch(e){console.warn("[HypergraphView] Error resizing graph:",e)}};return window.addEventListener("resize",n),window.addEventListener("keydown",b),l.current=t,()=>{if(window.removeEventListener("resize",n),window.removeEventListener("keydown",b),l.current)try{l.current.off(g.CLICK,a),l.current.off(D.CLICK,p),l.current.off(g.POINTER_ENTER,i),l.current.off(g.POINTER_LEAVE,y),l.current.destroy(),l.current=null}catch(e){console.warn("[HypergraphView] Error in cleanup:",e)}}}catch(r){return console.error("[HypergraphView] Error creating graph:",r),()=>{}}}},[f,d,R,F,H,S,b,x]),v.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",children:[v.jsx("div",{ref:u,className:"hypergraph-view flex-1"}),v.jsx("div",{ref:h,className:"graph-tooltip",style:{display:"none"}})]})});export{_ as default};
//# sourceMappingURL=HypergraphView-Bw2DSqaA.js.map
