import{r as i,u as B,a as P,j as H}from"./index-B3dX-oWs.js";import{s as I,G as O,N as p,C as x}from"./preset-DDHGbLzF.js";const z=[{fill:"#1890FF",stroke:"#0050B3"},{fill:"#52C41A",stroke:"#274704"},{fill:"#FA8C16",stroke:"#872000"},{fill:"#EB2F96",stroke:"#780C56"},{fill:"#13C2C2",stroke:"#0C464C"},{fill:"#722ED1",stroke:"#38165F"},{fill:"#F5222D",stroke:"#7F0000"},{fill:"#FA541C",stroke:"#7F2C00"},{fill:"#FFC53D",stroke:"#7F6400"},{fill:"#45B39D",stroke:"#0F5C4C"}];function K(N){return z[N%z.length]}const j=i.memo(function({data:n,meta:W}){const u=i.useRef(null),o=i.useRef(null),f=i.useRef(null),{selectedNodes:h,selectNode:R,deselectNode:w,clearSelection:k}=B(),{results:C}=P(),V=i.useCallback(r=>{var a;const s=(a=r.target)==null?void 0:a.id;s&&(h.has(s)?w(s):R(s))},[h,R,w]),F=i.useCallback(()=>{k()},[k]),S=i.useCallback(r=>{var a,c,t,y;const s=(a=r.target)==null?void 0:a.id;if(!(!s||!f.current||!o.current))try{const l=o.current.getNodeData(s);if(!l)return;const E=o.current.getElementPosition(s),[b,v]=E||[0,0],e=`
        <div class="graph-node-tooltip">
          <div class="tooltip-title">${((c=l.data)==null?void 0:c.label)||l.id}</div>
          <div class="tooltip-id">ID: ${l.id}</div>
          ${(t=l.data)!=null&&t.description?`<div class="tooltip-desc">${l.data.description}</div>`:""}
          ${((y=l.data)==null?void 0:y.value)!==void 0?`<div class="tooltip-value">Value: ${l.data.value}</div>`:""}
        </div>
      `;f.current.innerHTML=e,f.current.style.display="block",f.current.style.left=b+10+"px",f.current.style.top=v+10+"px"}catch(l){console.warn("[HypergraphView] Error in handleNodeMouseEnter:",l)}},[]),L=i.useCallback(()=>{f.current&&(f.current.style.display="none")},[]),m=i.useCallback(r=>{r.key==="Escape"?k():(r.ctrlKey||r.metaKey)&&r.key==="f"?(r.preventDefault(),I.info("搜索面板已激活")):r.key==="Delete"&&h.size>0&&(h.forEach(s=>{w(s)}),I.success("已清除选中节点"))},[h,k,w]),D=i.useCallback(r=>{if(r)try{const s=r.getNodeData()||[],a=new Set(C);s.forEach(c=>{const t=c.id;if(a.has(t))r.setElementState(t,["highlight"]);else{const l=(r.getElementState(t)||[]).filter(E=>E!=="highlight");r.setElementState(t,l)}}),C.length>0&&r.focusElement(C[0])}catch(s){console.warn("[HypergraphView] Error in highlightSearchResults:",s)}},[C]);return i.useEffect(()=>{var r,s,a;if(console.log("[HypergraphView] useEffect triggered"),console.log("[HypergraphView] data:",n),console.log("[HypergraphView] data.nodes:",((r=n==null?void 0:n.nodes)==null?void 0:r.length)||0),console.log("[HypergraphView] data.edges:",((s=n==null?void 0:n.edges)==null?void 0:s.length)||0),console.log("[HypergraphView] data.hyperedges:",((a=n==null?void 0:n.hyperedges)==null?void 0:a.length)||0),!u.current||!(n!=null&&n.nodes)){console.warn("[HypergraphView] Missing containerRef or data.nodes");return}if(o.current){try{o.current.destroy()}catch(c){console.warn("[HypergraphView] Error destroying previous graph:",c)}o.current=null}try{const c=(n.hyperedges||[]).map((e,d)=>{const g=K(d);return{key:`bubble-sets-${e.id}`,type:"bubble-sets",members:e.node_set,labelText:e.label,fill:g.fill,fillOpacity:.1,stroke:g.stroke,strokeOpacity:1,label:!0,labelCloseToPath:!1,labelPlacement:"top",labelBackgroundFill:g.stroke,labelFill:"#fff",labelPadding:3,labelBackgroundRadius:4}}),t=new O({container:u.current,width:u.current.clientWidth,height:u.current.clientHeight,layout:{type:"force",collide:{radius:e=>e.size/2},preventOverlap:!0},behaviors:["drag-canvas","zoom-canvas","drag-element"],node:{style:{labelText:e=>{var d;return((d=e.data)==null?void 0:d.label)||e.id},fontSize:12},state:{highlight:{fill:"#ffd666",stroke:"#faad14",lineWidth:2,shadowColor:"#faad14",shadowBlur:10},selected:{fill:"#1890ff",stroke:"#1890ff",lineWidth:3,shadowColor:"#1890ff",shadowBlur:10}}},edge:{style:{labelText:e=>{var d;return((d=e.data)==null?void 0:d.label)||""},fontSize:10,stroke:"#B4E5FF",opacity:.6},state:{highlight:{stroke:"#faad14",lineWidth:2,opacity:1}}},data:{nodes:n.nodes.map(e=>({...e,style:{...e.style,fill:h.has(e.id)?"#1890ff":"#87d068",lineWidth:h.has(e.id)?3:1,stroke:h.has(e.id)?"#1890ff":"#666"}})),edges:(n.edges||[]).map(e=>({...e,style:{stroke:"#B4E5FF",lineWidth:1,opacity:.6,...e.style}}))},plugins:c,autoFit:"center"}),y=V,l=F,E=S,b=L;t.on(p.CLICK,y),t.on(x.CLICK,l),t.on(p.POINTER_ENTER,E),t.on(p.POINTER_LEAVE,b),t.on(p.DBLCLICK,e=>{var d;try{const g=(d=e.target)==null?void 0:d.id;if(!g)return;(t.getNeighborNodesData(g)||[]).forEach(T=>{t.setElementState(T.id,["highlight"])})}catch(g){console.warn("[HypergraphView] Error in dblclick handler:",g)}}),t.render().then(()=>{console.log("[HypergraphView] Graph rendered successfully"),D(t)}).catch(e=>{console.error("[HypergraphView] Error rendering graph:",e)});const v=()=>{if(u.current&&o.current)try{o.current.resize(u.current.clientWidth,u.current.clientHeight)}catch(e){console.warn("[HypergraphView] Error resizing graph:",e)}};return window.addEventListener("resize",v),window.addEventListener("keydown",m),o.current=t,()=>{if(window.removeEventListener("resize",v),window.removeEventListener("keydown",m),o.current)try{o.current.off(p.CLICK,y),o.current.off(x.CLICK,l),o.current.off(p.POINTER_ENTER,E),o.current.off(p.POINTER_LEAVE,b),o.current.destroy(),o.current=null}catch(e){console.warn("[HypergraphView] Error in cleanup:",e)}}}catch(c){return console.error("[HypergraphView] Error creating graph:",c),()=>{}}},[n,h,V,F,S,L,m,D]),H.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[H.jsx("div",{ref:u,className:"hypergraph-view",style:{width:"100%",height:"100%"}}),H.jsx("div",{ref:f,className:"graph-tooltip",style:{display:"none"}})]})});export{j as default};
//# sourceMappingURL=HypergraphView-3x7u6gKG.js.map
