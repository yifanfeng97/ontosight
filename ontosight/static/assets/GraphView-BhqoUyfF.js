import{r as l,u as C,a as N,j as w}from"./index-BoSBHz_8.js";import{s as S,G as x}from"./preset-DZj1u2dW.js";const W=l.memo(function({data:s,meta:G}){const c=l.useRef(null),g=l.useRef(null),d=l.useRef(null),{selectedNodes:r,selectNode:v,deselectNode:a,clearSelection:h}=C(),{results:u}=N(),m=l.useCallback(e=>{const o=e.item;if(!o)return;const t=o.get("id");r.has(t)?a(t):v(t)},[r,v,a]),y=l.useCallback(()=>{h()},[h]),k=l.useCallback(e=>{const o=e.item;if(!o||!d.current)return;const t=o.getModel(),{x:n,y:i}=o.getModel(),f=`
      <div class="graph-node-tooltip">
        <div class="tooltip-title">${t.label||t.id}</div>
        <div class="tooltip-id">ID: ${t.id}</div>
        ${t.description?`<div class="tooltip-desc">${t.description}</div>`:""}
        ${t.value!==void 0?`<div class="tooltip-value">Value: ${t.value}</div>`:""}
      </div>
    `;d.current.innerHTML=f,d.current.style.display="block",d.current.style.left=(n??0)+10+"px",d.current.style.top=(i??0)+10+"px"},[]),E=l.useCallback(()=>{d.current&&(d.current.style.display="none")},[]),p=l.useCallback(e=>{e.key==="Escape"?h():(e.ctrlKey||e.metaKey)&&e.key==="f"?(e.preventDefault(),S.info("搜索面板已激活")):e.key==="Delete"&&r.size>0&&(r.forEach(o=>{a(o)}),S.success("已清除选中节点"))},[r,h,a]),R=l.useCallback(e=>{if(!e)return;const o=e.getNodes(),t=new Set(u);if(o.forEach(n=>{const i=n.getID();t.has(i)?(n.toFront(),e.setItemState(n,"highlight",!0)):e.setItemState(n,"highlight",!1)}),u.length>0){const n=e.findById(u[0]);n&&e.focusItem(n,!0)}},[u]);return l.useEffect(()=>{var t,n;if(console.log("[GraphView] useEffect triggered"),console.log("[GraphView] data:",s),console.log("[GraphView] data.nodes:",((t=s==null?void 0:s.nodes)==null?void 0:t.length)||0),console.log("[GraphView] data.edges:",((n=s==null?void 0:s.edges)==null?void 0:n.length)||0),!c.current||!(s!=null&&s.nodes)){console.warn("[GraphView] Missing containerRef or data.nodes");return}g.current&&g.current.destroy();const e=new x({container:c.current,width:c.current.clientWidth,height:c.current.clientHeight,modes:{default:["drag-canvas","zoom-canvas","drag-node"]},nodeStateStyles:{highlight:{fill:"#ffd666",stroke:"#faad14",lineWidth:2,shadowColor:"#faad14",shadowBlur:10},selected:{fill:"#1890ff",stroke:"#1890ff",lineWidth:3,shadowColor:"#1890ff",shadowBlur:10}},edgeStateStyles:{highlight:{stroke:"#faad14",lineWidth:2,opacity:1}},data:{nodes:s.nodes.map(i=>({...i,size:30,style:{fill:r.has(i.id)?"#1890ff":"#87d068",lineWidth:r.has(i.id)?3:1,stroke:r.has(i.id)?"#1890ff":"#666"}})),edges:(s.edges||[]).map(i=>({...i,style:{stroke:"#ccc",lineWidth:1}}))}});e.on("node:click",m),e.on("canvas:click",y),e.on("node:mouseenter",k),e.on("node:mouseleave",E),e.on("node:dblclick",i=>{const f=i.item;if(!f)return;e.getNeighbors(f).forEach(b=>{e.setItemState(b,"highlight",!0)})}),e.render(),R(e);const o=()=>{c.current&&e.changeSize(c.current.clientWidth,c.current.clientHeight)};return window.addEventListener("resize",o),window.addEventListener("keydown",p),g.current=e,()=>{window.removeEventListener("resize",o),window.removeEventListener("keydown",p),e.destroy()}},[s,r,m,y,k,E,p,R]),w.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[w.jsx("div",{ref:c,className:"graph-view"}),w.jsx("div",{ref:d,className:"graph-tooltip",style:{display:"none"}})]})});export{W as default};
//# sourceMappingURL=GraphView-BhqoUyfF.js.map
