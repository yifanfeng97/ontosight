import{r as l,u as C,a as N,j as y}from"./index-CKdJ6Www.js";import{s as R,G as z}from"./preset-Bwd7EjoF.js";const W=l.memo(function({data:o,meta:G}){const d=l.useRef(null),g=l.useRef(null),a=l.useRef(null),{selectedNodes:c,selectNode:v,deselectNode:h,clearSelection:u}=C(),{results:f}=N(),m=l.useCallback(e=>{const n=e.item;if(!n)return;const s=n.get("id");c.has(s)?h(s):v(s)},[c,v,h]),k=l.useCallback(()=>{u()},[u]),b=l.useCallback(e=>{var w;const n=e.item;if(!n||!a.current)return;const s=n.getModel(),{x:i,y:t}=n.getModel(),r=`
      <div class="graph-node-tooltip">
        <div class="tooltip-title">${((w=s.data)==null?void 0:w.label)||s.id}</div>
        <div class="tooltip-id">ID: ${s.id}</div>
        ${s.description?`<div class="tooltip-desc">${s.description}</div>`:""}
        ${s.value!==void 0?`<div class="tooltip-value">Value: ${s.value}</div>`:""}
      </div>
    `;a.current.innerHTML=r,a.current.style.display="block",a.current.style.left=(i??0)+10+"px",a.current.style.top=(t??0)+10+"px"},[]),S=l.useCallback(()=>{a.current&&(a.current.style.display="none")},[]),p=l.useCallback(e=>{e.key==="Escape"?u():(e.ctrlKey||e.metaKey)&&e.key==="f"?(e.preventDefault(),R.info("搜索面板已激活")):e.key==="Delete"&&c.size>0&&(c.forEach(n=>{h(n)}),R.success("已清除选中节点"))},[c,u,h]),E=l.useCallback(e=>{if(!e)return;const n=e.getNodes(),s=new Set(f);if(n.forEach(i=>{const t=i.getID();s.has(t)?(i.toFront(),e.setItemState(i,"highlight",!0)):e.setItemState(i,"highlight",!1)}),f.length>0){const i=e.findById(f[0]);i&&e.focusItem(i,!0)}},[f]);return l.useEffect(()=>{var s,i;if(console.log("[GraphView] useEffect triggered"),console.log("[GraphView] data:",o),console.log("[GraphView] data.nodes:",((s=o==null?void 0:o.nodes)==null?void 0:s.length)||0),console.log("[GraphView] data.edges:",((i=o==null?void 0:o.edges)==null?void 0:i.length)||0),!d.current||!(o!=null&&o.nodes)){console.warn("[GraphView] Missing containerRef or data.nodes");return}g.current&&g.current.destroy();const e=new z({container:d.current,width:d.current.clientWidth,height:d.current.clientHeight,modes:{default:["drag-canvas","zoom-canvas","drag-node"]},node:{style:{labelText:t=>{var r;return((r=t.data)==null?void 0:r.label)||t.id},fontSize:12}},edge:{style:{labelText:t=>{var r;return((r=t.data)==null?void 0:r.label)||""},fontSize:10}},nodeStateStyles:{highlight:{fill:"#ffd666",stroke:"#faad14",lineWidth:2,shadowColor:"#faad14",shadowBlur:10},selected:{fill:"#1890ff",stroke:"#1890ff",lineWidth:3,shadowColor:"#1890ff",shadowBlur:10}},edgeStateStyles:{highlight:{stroke:"#faad14",lineWidth:2,opacity:1}},data:{nodes:o.nodes.map(t=>({...t,size:30,style:{fill:c.has(t.id)?"#1890ff":"#87d068",lineWidth:c.has(t.id)?3:1,stroke:c.has(t.id)?"#1890ff":"#666"}})),edges:(o.edges||[]).map(t=>({...t,style:{stroke:"#ccc",lineWidth:1}}))}});e.on("node:click",m),e.on("canvas:click",k),e.on("node:mouseenter",b),e.on("node:mouseleave",S),e.on("node:dblclick",t=>{const r=t.item;if(!r)return;e.getNeighbors(r).forEach(x=>{e.setItemState(x,"highlight",!0)})}),e.render(),E(e);const n=()=>{d.current&&e.changeSize(d.current.clientWidth,d.current.clientHeight)};return window.addEventListener("resize",n),window.addEventListener("keydown",p),g.current=e,()=>{window.removeEventListener("resize",n),window.removeEventListener("keydown",p),e.destroy()}},[o,c,m,k,b,S,p,E]),y.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[y.jsx("div",{ref:d,className:"graph-view"}),y.jsx("div",{ref:a,className:"graph-tooltip",style:{display:"none"}})]})});export{W as default};
//# sourceMappingURL=GraphView-DR8dcVdy.js.map
