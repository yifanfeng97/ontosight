import{r as n,u as z,a as I,b as B,j as V}from"./index-MwAwkXWd.js";import{G as N,N as b,C as x}from"./preset-pCXyFRGM.js";const D=[{fill:"#1890FF",stroke:"#0050B3"},{fill:"#52C41A",stroke:"#274704"},{fill:"#FA8C16",stroke:"#872000"},{fill:"#EB2F96",stroke:"#780C56"},{fill:"#13C2C2",stroke:"#0C464C"},{fill:"#722ED1",stroke:"#38165F"},{fill:"#F5222D",stroke:"#7F0000"},{fill:"#FA541C",stroke:"#7F2C00"},{fill:"#FFC53D",stroke:"#7F6400"},{fill:"#45B39D",stroke:"#0F5C4C"}];function K(m){return D[m%D.length]}const P=n.memo(function({data:u,meta:W}){const f=n.useRef(null),s=n.useRef(null),C=n.useRef(new Map),d=n.useRef(new Map),{selectedItems:g,selectItem:y,deselectItem:h,clearSelection:p,resetTrigger:H}=z(),{results:w}=I(),{addToast:k}=B();n.useEffect(()=>{d.current=g},[g]);const S=n.useCallback(r=>{var o;const t=(o=r.target)==null?void 0:o.id;t&&(d.current.has(t)?h(t):y(t,"node"))},[y,h]),F=n.useCallback(r=>{d.current.has(r)?h(r):y(r,"hyperedge")},[y,h]);n.useCallback(()=>{p()},[p]),n.useCallback(()=>{},[]);const E=n.useCallback(r=>{r.key==="Escape"?p():(r.ctrlKey||r.metaKey)&&r.key==="f"?(r.preventDefault(),k("搜索面板已激活","info")):r.key==="Delete"&&d.current.size>0&&(d.current.forEach(t=>{h(t.id)}),k("已清除选中项","success"))},[p,h,k]),R=n.useCallback(r=>{if(r)try{const t=r.getNodeData()||[],o=new Set(w);t.forEach(c=>{const i=c.id;if(o.has(i))r.setElementState(i,["highlight"]);else{const l=(r.getElementState(i)||[]).filter(a=>a!=="highlight");r.setElementState(i,l)}}),w.length>0&&r.focusElement(w[0])}catch(t){console.warn("[HypergraphView] Error in highlightSearchResults:",t)}},[w]);return n.useEffect(()=>{if(!(!f.current||!(u!=null&&u.nodes))){if(s.current){try{s.current.destroy()}catch(r){console.warn("[HypergraphView] Error destroying previous graph:",r)}s.current=null}try{const r=(u.hyperedges||[]).map((e,l)=>{const a=K(l);return C.current.set(e.id,e),{key:`bubble-sets-${e.id}`,type:"bubble-sets",members:e.node_set,labelText:e.label,fill:a.fill,fillOpacity:.1,stroke:a.stroke,strokeOpacity:.6,label:!0,labelCloseToPath:!1,labelPlacement:"top",labelBackgroundFill:a.stroke,labelFill:"#fff",labelPadding:3,labelBackgroundRadius:4}}),t=new N({container:f.current,width:f.current.clientWidth,height:f.current.clientHeight,layout:{type:"force",collide:{radius:e=>e.size/2},preventOverlap:!0},behaviors:["drag-canvas","zoom-canvas","drag-element"],node:{style:{labelText:e=>{var l;return((l=e.data)==null?void 0:l.label)||e.id},fontSize:12},state:{highlight:{fill:"#ffd666",stroke:"#faad14",lineWidth:2,shadowColor:"#faad14",shadowBlur:10},selected:{fill:"#1890ff",stroke:"#1890ff",lineWidth:3,shadowColor:"#1890ff",shadowBlur:10}}},edge:{style:{labelText:e=>{var l;return((l=e.data)==null?void 0:l.label)||""},fontSize:10,stroke:"#B4E5FF",opacity:.6},state:{highlight:{stroke:"#faad14",lineWidth:2,opacity:1}}},data:{nodes:u.nodes.map(e=>{const l=g.has(e.id);return{...e,style:{...e.style,fill:l?"#1890ff":"#87d068",lineWidth:l?3:1,stroke:l?"#1890ff":"#666"}}}),edges:(u.edges||[]).map(e=>({...e,style:{stroke:"#B4E5FF",lineWidth:1,opacity:.6,...e.style}}))},plugins:r,autoFit:"center"}),o=S,c=e=>{const l=e.target;if(l&&l.textContent){for(const[a,v]of C.current.entries())if(l.textContent.includes(v.label)){F(a);return}}p()};t.on(b.CLICK,o),t.on(x.CLICK,c),t.on(b.DBLCLICK,e=>{var l;try{const a=(l=e.target)==null?void 0:l.id;if(!a)return;(t.getNeighborNodesData(a)||[]).forEach(L=>{t.setElementState(L.id,["highlight"])})}catch(a){console.warn("[HypergraphView] Error in dblclick handler:",a)}}),t.render().then(()=>{console.log("[HypergraphView] Graph rendered successfully"),R(t)}).catch(e=>{console.error("[HypergraphView] Error rendering graph:",e)});const i=()=>{if(f.current&&s.current)try{s.current.resize(f.current.clientWidth,f.current.clientHeight)}catch(e){console.warn("[HypergraphView] Error resizing graph:",e)}};return window.addEventListener("resize",i),window.addEventListener("keydown",E),s.current=t,C.current.clear(),()=>{if(window.removeEventListener("resize",i),window.removeEventListener("keydown",E),s.current)try{s.current.off(b.CLICK,o),s.current.off(x.CLICK,c),s.current.destroy(),s.current=null}catch(e){console.warn("[HypergraphView] Error in cleanup:",e)}}}catch(r){return console.error("[HypergraphView] Error creating graph:",r),()=>{}}}},[u,S,F,E,R]),n.useEffect(()=>{if(!s.current||H===0)return;(async()=>{var t,o;try{console.log("[HypergraphView] Relayouting graph..."),(t=s.current)==null||t.stopLayout(),await((o=s.current)==null?void 0:o.layout()),console.log("[HypergraphView] Relayout completed")}catch(c){console.warn("[HypergraphView] Error relayouting graph on reset:",c)}})()},[H]),n.useEffect(()=>{if(!s.current||!u)return;(async()=>{var t,o;try{(t=u.nodes)==null||t.forEach(c=>{var e;const i=g.has(c.id);(e=s.current)==null||e.updateNodeData([{id:c.id,style:{fill:i?"#1890ff":"#87d068",lineWidth:i?3:1,stroke:i?"#1890ff":"#666"}}])}),await((o=s.current)==null?void 0:o.draw())}catch(c){console.warn("[HypergraphView] Error updating selection styles:",c)}})()},[g,u]),V.jsx("div",{className:"w-full h-full flex flex-col overflow-hidden",children:V.jsx("div",{ref:f,className:"hypergraph-view flex-1"})})});export{P as default};
//# sourceMappingURL=HypergraphView-LOAc2ke6.js.map
