openapi: 3.0.0
info:
  title: OntoSight Core Visualization API
  version: 1.0.0
  description: |
    REST API for OntoSight visualization engine.
    
    This API provides endpoints for:
    - Schema metadata export
    - Visualization data retrieval
    - Search interface
    - Chat interface
  contact:
    name: OntoSight Team
  license:
    name: MIT

servers:
  - url: http://localhost:8000
    description: Development server
  - url: https://api.ontosight.io
    description: Production server

paths:
  /api/health:
    head:
      summary: Health check
      operationId: healthCheck
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
        '503':
          description: Service is unavailable

  /api/meta:
    get:
      summary: Get visualization metadata
      operationId: getMeta
      tags:
        - Metadata
      description: |
        Export JSON Schemas for all data types.
        
        Used by frontend to generate dynamic property panels.
      responses:
        '200':
          description: Metadata retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetaResponse'
        '404':
          description: No visualization loaded yet
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/data:
    get:
      summary: Get current visualization data
      operationId: getData
      tags:
        - Data
      description: Retrieve nodes, edges, items, and hyperedges
      responses:
        '200':
          description: Visualization data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VisualizationData'
        '404':
          description: No visualization loaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/search:
    post:
      summary: Search visualization
      operationId: search
      tags:
        - Search
      description: Query nodes by text search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchRequest'
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '400':
          description: Invalid search request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/chat:
    post:
      summary: Chat with visualization
      operationId: chat
      tags:
        - Chat
      description: Submit questions about the visualization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
      responses:
        '200':
          description: Chat response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
        '400':
          description: Invalid chat request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    # Base Types
    Node:
      type: object
      description: Generic graph node
      required:
        - id
        - data
        - label
      properties:
        id:
          type: string
          description: Unique node identifier
          example: "node_1"
        data:
          oneOf:
            - type: object
              additionalProperties: true
            - type: string
            - type: number
            - type: boolean
          description: Domain-specific node data
          example:
            name: "Alice"
            age: 30
        label:
          type: string
          description: Display label for UI rendering
          example: "Alice (age 30)"

    Edge:
      type: object
      description: Generic edge connecting two nodes
      required:
        - source
        - target
        - data
        - label
      properties:
        source:
          type: string
          description: Source node ID
          example: "node_1"
        target:
          type: string
          description: Target node ID
          example: "node_2"
        data:
          oneOf:
            - type: object
              additionalProperties: true
            - type: string
            - type: number
          description: Edge metadata
          example:
            relation: "knows"
            weight: 0.8
        label:
          type: string
          description: Display label
          example: "knows"

    TreeNode:
      type: object
      description: Hierarchical node for tree structures (recursive)
      required:
        - id
        - data
        - label
        - children
      properties:
        id:
          type: string
          description: Node ID
          example: "root"
        data:
          oneOf:
            - type: object
              additionalProperties: true
            - type: string
            - type: number
          description: Node data
        label:
          type: string
          description: Display label
        children:
          type: array
          items:
            $ref: '#/components/schemas/TreeNode'
          description: Child nodes (recursive)

    HyperEdge:
      type: object
      description: Multi-node edge connecting 2+ nodes
      required:
        - nodes
        - data
        - label
      properties:
        nodes:
          type: array
          items:
            type: string
          minItems: 2
          description: Node IDs in this hyperedge
          example:
            - "node_1"
            - "node_2"
            - "node_3"
        data:
          oneOf:
            - type: object
              additionalProperties: true
            - type: string
          description: Hyperedge metadata
        label:
          type: string
          description: Display label

    # API Request/Response Types
    MetaResponse:
      type: object
      description: Metadata response with JSON Schemas
      properties:
        node_schema:
          type: object
          description: JSON Schema for nodes
          nullable: true
        edge_schema:
          type: object
          description: JSON Schema for edges
          nullable: true
        item_schema:
          type: object
          description: JSON Schema for tree items
          nullable: true
        hyperedge_schema:
          type: object
          description: JSON Schema for hyperedges
          nullable: true

    VisualizationData:
      type: object
      description: Complete visualization payload
      properties:
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/Node'
          description: Graph nodes
          default: []
        edges:
          type: array
          items:
            $ref: '#/components/schemas/Edge'
          description: Graph edges
          default: []
        items:
          type: array
          items:
            $ref: '#/components/schemas/TreeNode'
          description: Tree nodes
          default: []
        hyperedges:
          type: array
          items:
            $ref: '#/components/schemas/HyperEdge'
          description: Hyperedges
          default: []

    SearchRequest:
      type: object
      description: Search query request
      required:
        - query
      properties:
        query:
          type: string
          description: Search query string
          example: "find Alice"
          minLength: 1
        context:
          type: object
          description: Optional search context
          nullable: true
          example:
            field: "name"
            operator: "contains"

    SearchResponse:
      type: object
      description: Search results
      required:
        - results
      properties:
        results:
          type: array
          items:
            type: string
          description: Matching node IDs
          example:
            - "node_1"
            - "node_3"

    ChatRequest:
      type: object
      description: Chat query request
      required:
        - query
      properties:
        query:
          type: string
          description: Chat query
          example: "What is the relationship between Alice and Bob?"
          minLength: 1
        context:
          type: object
          description: Optional context (e.g., conversation history)
          nullable: true

    ChatResponse:
      type: object
      description: Chat response
      required:
        - response
      properties:
        response:
          type: string
          description: Chat response text
          example: "Alice and Bob are connected by a 'knows' relationship."
        sources:
          type: array
          items:
            type: string
          description: Source node IDs referenced in response
          nullable: true
          example:
            - "node_1"
            - "node_2"

    ErrorResponse:
      type: object
      description: Error response
      required:
        - error
      properties:
        error:
          type: string
          description: Error message
        detail:
          type: string
          description: Error details
        status:
          type: integer
          description: HTTP status code
